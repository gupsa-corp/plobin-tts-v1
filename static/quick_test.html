<!DOCTYPE html>
<html>
<head>
    <title>ë§ˆì´í¬ ê¶Œí•œ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>ğŸ¤ ë§ˆì´í¬ ê¶Œí•œ í…ŒìŠ¤íŠ¸</h1>
    <button id="testMic">ë§ˆì´í¬ í…ŒìŠ¤íŠ¸</button>
    <button id="testWS">WebSocket í…ŒìŠ¤íŠ¸</button>
    <div id="log"></div>

    <script>
        function log(msg) {
            document.getElementById('log').innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + msg + '</div>';
        }

        document.getElementById('testMic').onclick = async function() {
            log('ë§ˆì´í¬ ê¶Œí•œ ìš”ì²­ ì¤‘...');
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    audio: {
                        sampleRate: 16000,
                        channelCount: 1,
                        echoCancellation: true,
                        noiseSuppression: true
                    }
                });
                log('âœ… ë§ˆì´í¬ ê¶Œí•œ ì„±ê³µ!');

                const audioTracks = stream.getAudioTracks();
                if (audioTracks.length > 0) {
                    log('ì˜¤ë””ì˜¤ íŠ¸ë™: ' + audioTracks[0].label);
                }

                stream.getTracks().forEach(track => track.stop());
            } catch (error) {
                log('âŒ ë§ˆì´í¬ ê¶Œí•œ ì‹¤íŒ¨: ' + error.message);
            }
        };

        document.getElementById('testWS').onclick = function() {
            log('WebSocket ì—°ê²° ì‹œë„...');
            const ws = new WebSocket('ws://localhost:6001/ws/chat');

            ws.onopen = function() {
                log('âœ… WebSocket ì—°ê²° ì„±ê³µ!');
                ws.send(JSON.stringify({type: 'ping', timestamp: new Date().toISOString()}));
            };

            ws.onmessage = function(event) {
                log('ğŸ“¨ ìˆ˜ì‹ : ' + event.data);
            };

            ws.onclose = function() {
                log('âŒ WebSocket ì—°ê²° ì¢…ë£Œ');
            };

            ws.onerror = function(error) {
                log('âŒ WebSocket ì˜¤ë¥˜: ' + error);
            };
        };
    </script>
</body>
</html>